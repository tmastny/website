---
title: Tidying Messy Spreadsheets
author: ~
date: '2018-01-13'
slug: tidying-messy-spreadsheets-dplyr
categories: []
tags: []
description: Tidying Messy Spreadsheets with dplyr and tidyr 
meta_img: /images/image.jpg
publishdate: '2018-01-20'
output:
  blogdown::html_page:
    toc: true
---


<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#cleaning">Cleaning</a></li>
</ul>
</div>

<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This post is part introduction, part appendix. This first goal of this post is to be an introduction to cleaning and preparing a messy spreadsheet as part of a data science pipeline. In educational environments data is served in a convenient format that is immediately ready to be subjected to an array of algorithms from which we hope to drive some insight. But as Hadley explains in his <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html">transformative paper</a>, the reality is that the data scientists spend 80% of their time preparing data, and only 20% on the analysis itself. In his article, Hadley identifies tidy data as data that is ready to be analyzed by statistical programs. The tidy data is usually characterized by</p>
<ul>
<li><p>one variable per column</p></li>
<li><p>one observation per row</p></li>
<li><p>each type of observational unit forms a table</p></li>
</ul>
<p>He also introduces packages for R that facilitate tidying, which he has collected under the the brand <a href="https://www.tidyverse.org/">tidyverse</a>. We are going to use these tools, particularly <code>dplyr</code> and <code>tidyr</code> to tidy a messy spreadsheet.</p>
<p>This post also serves as an appendix to a future blog post analyzing Greg Nuckol’s meta-analysis on periodization in strength training found on his website <a href="https://www.strongerbyscience.com/periodization-data/">Strong By Science</a>. Greg shared his data and encouraged others to analyze it, which is absolutely fantastic. However, as organized, the data is not well suited for analysis by statistical programs.</p>
<p>I want to make it clear that I’m not picking on Greg and this isn’t an indictment of his skills as a researcher. I’ve created my fair share of <a href="https://twitter.com/hadleybeeman/status/934867384577462274">feral systems</a>. And as Hadley explains in his paper, tidy data, which is data organized for computer analysis, often sacrifices human readability and has various other <a href="https://simplystatistics.org/2016/02/17/non-tidy-data/">trade-offs</a>. I commend Greg’s own analysis and his willingness to share his data, and I’m happy to go through the exercise of cleaning it up.</p>
<p>Finally, note that the original data, the R script used to clean it, and the final tidy data can all be found in the <a href="https://github.com/tmastny/periodization-meta-analysis">github repo</a> I created to analyze Greg’s work.</p>
</div>
<div id="cleaning" class="section level2">
<h2>Cleaning</h2>
<p>The first step is to actually look at the data. Since Greg shared his data on Google sheets, this was my first glimpse of the data.</p>
<div class="figure">
<img src="/blog/spreadsheet_pic.png" />

</div>
<p>Greg has only filled out the study’s details for it’s first occurence in the spreadsheet. This makes it easy to read by adding white space between each study, but hard for the computer because there is an implicit spatial relation, which makes grouping and lookups difficult.</p>
<p>Luckily, we can easily correct this spatial dependence<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>: the first five variables always inherent the data from the previous row. We can code that as follows:</p>
<pre class="r"><code>library(tidyverse)
library(magrittr)
d &lt;- readxl::read_excel(&#39;Periodization Stuff.xlsx&#39;)

for (i in 1:nrow(d)) {
  if (is.na(d[i,1])) {
    d[i, c(1, 2, 3, 4, 5)] = d[i - 1, c(1, 2, 3, 4, 5)]
  }
}</code></pre>
<p>As you can see above, each observation is not completely filled out. This makes it easier to read, but can lead to difficulties when writing programs and scripts. Luckily there doesn’t seem to be other common <a href="http://blog.revolutionanalytics.com/2017/11/good-practices-spreadsheets.html">spreadsheet issues</a> formatting as data or formulas. There are a few merged cells, but they aren’t across rows and they are over studies that I won’t include in my analysis. I’ll discuss my inclusive criteria in the methodology section.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>When we can’t easily correct this spatial depedence, for example with Excel pivot tables, I recommend the <a href="https://cran.r-project.org/web/packages/tidyxl/vignettes/tidyxl.html">tidyxl</a> package.<a href="#fnref1">↩</a></p></li>
</ol>
</div>
